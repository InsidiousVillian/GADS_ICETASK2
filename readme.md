# Controls Not Included – Room Escape Prototype

## Overview

“Controls Not Included” is a small browser-based room escape prototype built for a game jam.  
You play as a confused test subject trapped in a sterile simulation chamber where the rules keep changing mid-experiment.  
Controls invert, rooms lie to you, and doors behave “almost” correctly, provoking constant **“uhm, nope, what?”** moments.

This project is implemented in vanilla JavaScript with a single `canvas` element and runs entirely in the browser via `index.html`.

## Features

- **Rule-Flipping Core Loop**: Each round teaches an expectation (controls, door behavior, layout) and then breaks it.
- **Dynamic Obstacles & Fake Doors**: Moving hazards and decoy exits that reinforce the theme without being unfair.
- **Confused Test Subject Character**: A simple but expressive avatar with glows, shields, and UI reactions.
- **Reversed Controls Mechanic**: Manual and automatic control flips, with audio feedback and HUD indicators.
- **Procedural Techno Background Music**:
  - 120–140 BPM techno/electronic loop (~64 seconds).
  - Generated by a Python script instead of a DAW.
  - Plays as a seamless loop during gameplay, with a short fade out on game over.

## How It Works

### Game Loop

- `index.html` hosts a fixed-size `canvas` and loads `game.js`.
- `game.js`:
  - Sets up the arena, player, door, obstacles, and fake doors.
  - Uses `requestAnimationFrame` to update movement, collisions, survival timers, and UI each frame.
  - Generates new random rooms each round and gradually increases difficulty.
  - Tracks round state (`currentRound`, `gameWon`, `gameLost`, `doorUnlocked`, etc.).

### Background Music System

- The procedural music is synthesized by `generate_bgm_techno_loop.py` and written as:
  - `assets/audio/music/bgm_techno_loop.wav`
- In `game.js`, a **singleton-style music manager** handles playback:
  - Creates one `HTMLAudioElement` (`bgmAudio`) the first time it is needed.
  - Sets `loop = true` and a conservative volume (`BGM_DEFAULT_VOLUME`).
  - Starts playback only in response to a **user key press** (to satisfy browser autoplay policies).
  - Fades the music out over ~800 ms when the player dies (`gameLost`).
  - Does **not** create additional audio objects when rounds restart.

### Audio Effects

- Short beeps for:
  - Reversed controls toggling.
  - Shield activation/deactivation from decoy portals.
- Implemented using the Web Audio API (`AudioContext`) in `game.js`.
- Background music uses an `Audio` element instead, to keep CPU usage low and code simple.

## Usage

### Running the Game

1. Open the project folder:
   - `c:\Users\jetta\OneDrive\Documentos\GADS_IceTask2`
2. Double-click `index.html` (or open it in your browser).
3. The game will start in your default browser.

Once you press any non-ESC key, the background music system will attempt to start playback.  
If your browser blocks autoplay, simply move or press another key to give it a valid user gesture.

### Regenerating the Background Music

If you want to tweak or regenerate the techno loop:

1. Ensure you have Python 3 installed.
2. From the project root, run:

   ```bash
   python generate_bgm_techno_loop.py
   ```

3. The script will:
   - Procedurally synthesize a ~64-second techno loop at 128 BPM.
   - Write `bgm_techno_loop.wav` into `assets/audio/music/`.

Reload the game page after regenerating to hear the updated loop.

## Controls

- **Move**: `W A S D`
- **Toggle Reversed Controls / Restart After Death**: `R`
- **Pause / Resume**: `ESC`

In keeping with the theme:

- Controls will sometimes invert automatically during a round.
- On-screen HUD and beeps help you notice when the rules change.

## Files Involved

- `index.html` – Entry point; loads the canvas and `game.js`.
- `game.js` – Core gameplay, input, UI, obstacle logic, decoy portals, and audio hooks.
- `generate_bgm_techno_loop.py` – Procedural techno loop generator.
- `assets/player.png`, `assets/door.png`, `assets/floor.png`, `assets/wall.png`, `assets/obstacle.png` – AI-generated sprites.
- `assets/audio/music/bgm_techno_loop.wav` – Background music loop generated by the Python script.
- `HighConcept.md` – High-level design, theme, and character description.
- `plan.md` – Day-by-day development plan for the prototype.
- `refinement-changes.md` – Log of documentation and system refinements.

## Notes

- **Autoplay & User Gestures**:
  - The music only attempts to start after a non-ESC key press.
  - This keeps behavior consistent across browsers with strict autoplay rules.
- **Performance & Memory**:
  - The music system uses exactly **one** `HTMLAudioElement` and reuses it across rounds.
  - No new audio objects are created on restart, preventing leaks and stacking.
- **Extending the Music System**:
  - If you add more tracks (e.g., game over, menu), extend the manager in `game.js` rather than creating new `Audio` instances in random functions.
  - Keep any new audio tied to user actions where possible.

Decoy Portal Feature
Overview

Dynamic arena feature introducing risk/reward mechanics. Players entering the portal may be sent back to the start of the round (penalty) or receive a temporary shield buff (reward) that lasts until colliding with an obstacle, which is then destroyed. Encourages strategic decision-making and adds tension to arena gameplay.

How to Play

Approach a Decoy Portal carefully – it may:

Teleport you back to the start of the round.

Grant a shield buff until you hit an obstacle.

Use the shield buff strategically to pass through obstacles safely.

Visual and audio cues indicate shield activation and loss.

Run

Integrate the DecoyPortal object in the arena scene.

Portals can be randomized or manually assigned for teleport/shield effects.

Shield interactions rely on obstacle collision detection for proper behavior.

AI Tools Used

Cursor – code generation & debugging

ChatGPT – documentation & ideation

Credits

Developer: Jet Kingston

AI collaborators: Cursor, ChatGPT